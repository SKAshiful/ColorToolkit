<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Color Toolkit</title>
  <style>
    :root {
      --primary-color: #4fc3f7;
      --background-color: #121212;
      --surface-color: #1e1e1e;
      --text-color: #ffffff;
      --border-color: #444;
      --border-radius: 8px;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .main-container, .side-container {
      background-color: var(--surface-color);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .main-container {
      width: 100%;
      max-width: 450px;
    }
    .side-container {
        width: 100%;
        max-width: 450px;
    }
    h1, h2 {
      text-align: center;
      color: var(--primary-color);
      margin-top: 0;
    }
    .input-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #bbbbbb;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      background: #2c2c2c;
      color: var(--text-color);
      box-sizing: border-box;
    }
    input[type="color"] {
      width: 100%;
      height: 50px;
      border: none;
      padding: 0;
      border-radius: var(--border-radius);
      cursor: pointer;
    }
    .preview {
      height: 100px;
      margin-top: 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      transition: background-color 0.2s ease;
    }
    .output .value {
      background: #2c2c2c;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: var(--border-radius);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Courier New', Courier, monospace;
      word-break: break-all;
    }
    .copy-btn {
      padding: 5px 12px;
      font-size: 14px;
      cursor: pointer;
      background-color: var(--primary-color);
      border: none;
      border-radius: 5px;
      color: #000;
      transition: background-color 0.2s;
    }
    .copy-btn:hover {
      background-color: #81d4fa;
    }
    .action-button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      background-color: var(--primary-color);
      border: none;
      border-radius: var(--border-radius);
      color: #000;
      margin-top: 10px;
    }
    #favouritesContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .fav-swatch {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid var(--border-color);
      position: relative;
    }
    .fav-swatch .delete-fav {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      background: tomato;
      color: white;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .fav-swatch:hover .delete-fav {
      opacity: 1;
    }
    #imagePickerContainer, #cameraContainer {
        border-top: 2px solid var(--border-color);
        margin-top: 20px;
        padding-top: 20px;
    }
    #imageCanvas, #cameraFeed {
        max-width: 100%;
        border-radius: var(--border-radius);
        cursor: crosshair;
        background: #333;
    }
    .picker-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    #cameraFeed { display: none; }
  </style>
</head>
<body>

  <div class="main-container">
    <h1>Advanced Color Toolkit</h1>
    
    <div class="input-group">
      <label for="colorPicker">Choose a Color</label>
      <input type="color" id="colorPicker" value="#4fc3f7">
    </div>

    <div class="input-group">
      <label for="textInput">Enter Color Value (Name, HEX, RGB, HSL)</label>
      <input type="text" id="textInput" placeholder="e.g., #ff6347, rgb(255, 99, 71), tomato">
    </div>

    <div class="preview" id="preview"></div>
    <button id="saveFavouriteBtn" class="action-button">Save to Favourites</button>

    <div class="output">
      <h2>Outputs</h2>
      <div class="value"><span>HEX:</span> <span id="hexValue"></span> <button class="copy-btn" onclick="copy('hexValue')">Copy</button></div>
      <div class="value"><span>RGBA:</span> <span id="rgbaValue"></span> <button class="copy-btn" onclick="copy('rgbaValue')">Copy</button></div>
      <div class="value"><span>HSL:</span> <span id="hslValue"></span> <button class="copy-btn" onclick="copy('hslValue')">Copy</button></div>
      <div class="value"><span>HSLA:</span> <span id="hslaValue"></span> <button class="copy-btn" onclick="copy('hslaValue')">Copy</button></div>
      <div class="value"><span>Keyword:</span> <span id="keywordValue"></span> <button class="copy-btn" onclick="copy('keywordValue')">Copy</button></div>
    </div>
  </div>

  <div class="side-container">
    <h2>Favourites</h2>
    <div id="favouritesContainer"></div>

    <div id="imagePickerContainer">
        <h2>Image Color Picker</h2>
        <label for="imageLoader">Upload an image to pick a color:</label>
        <input type="file" id="imageLoader" accept="image/*">
        <canvas id="imageCanvas"></canvas>
    </div>
    
    <div id="cameraContainer">
        <h2>Camera Color Picker</h2>
        <div class="picker-controls">
            <button id="startCameraBtn" class="action-button">Start Camera</button>
            <button id="stopCameraBtn" class="action-button" style="display: none; background-color: #ff6347;">Stop Camera</button>
        </div>
        <video id="cameraFeed" playsinline autoplay></video>
        <canvas id="cameraCanvas" style="display:none;"></canvas>
    </div>
  </div>

  <script>
    // --- DOM ELEMENT REFERENCES ---
    const colorPicker = document.getElementById("colorPicker");
    const textInput = document.getElementById("textInput");
    const preview = document.getElementById("preview");
    
    const hexValue = document.getElementById("hexValue");
    const rgbaValue = document.getElementById("rgbaValue");
    const hslValue = document.getElementById("hslValue");
    const hslaValue = document.getElementById("hslaValue");
    const keywordValue = document.getElementById("keywordValue");

    const saveFavouriteBtn = document.getElementById("saveFavouriteBtn");
    const favouritesContainer = document.getElementById("favouritesContainer");
    
    const imageLoader = document.getElementById('imageLoader');
    const imageCanvas = document.getElementById('imageCanvas');
    const imageCtx = imageCanvas.getContext('2d');
    
    const startCameraBtn = document.getElementById('startCameraBtn');
    const stopCameraBtn = document.getElementById('stopCameraBtn');
    const cameraFeed = document.getElementById('cameraFeed');
    const cameraCanvas = document.getElementById('cameraCanvas');
    const cameraCtx = cameraCanvas.getContext('2d');
    let videoStream;

    // --- STATE ---
    let currentRgba = { r: 79, g: 195, b: 247, a: 1 };
    let favourites = JSON.parse(localStorage.getItem("favouriteColors")) || [];

    // --- COLOR KEYWORDS LOOKUP ---
    const CSS_COLORS = {"aliceblue":"#f0f8ff","antiquewhite":"#faebd7","aqua":"#00ffff","aquamarine":"#7fffd4","azure":"#f0ffff","beige":"#f5f5dc","bisque":"#ffe4c4","black":"#000000","blanchedalmond":"#ffebcd","blue":"#0000ff","blueviolet":"#8a2be2","brown":"#a52a2a","burlywood":"#deb887","cadetblue":"#5f9ea0","chartreuse":"#7fff00","chocolate":"#d2691e","coral":"#ff7f50","cornflowerblue":"#6495ed","cornsilk":"#fff8dc","crimson":"#dc143c","cyan":"#00ffff","darkblue":"#00008b","darkcyan":"#008b8b","darkgoldenrod":"#b8860b","darkgray":"#a9a9a9","darkgreen":"#006400","darkkhaki":"#bdb76b","darkmagenta":"#8b008b","darkolivegreen":"#556b2f","darkorange":"#ff8c00","darkorchid":"#9932cc","darkred":"#8b0000","darksalmon":"#e9967a","darkseagreen":"#8fbc8f","darkslateblue":"#483d8b","darkslategray":"#2f4f4f","darkturquoise":"#00ced1","darkviolet":"#9400d3","deeppink":"#ff1493","deepskyblue":"#00bfff","dimgray":"#696969","dodgerblue":"#1e90ff","firebrick":"#b22222","floralwhite":"#fffaf0","forestgreen":"#228b22","fuchsia":"#ff00ff","gainsboro":"#dcdcdc","ghostwhite":"#f8f8ff","gold":"#ffd700","goldenrod":"#daa520","gray":"#808080","green":"#008000","greenyellow":"#adff2f","honeydew":"#f0fff0","hotpink":"#ff69b4","indianred":"#cd5c5c","indigo":"#4b0082","ivory":"#fffff0","khaki":"#f0e68c","lavender":"#e6e6fa","lavenderblush":"#fff0f5","lawngreen":"#7cfc00","lemonchiffon":"#fffacd","lightblue":"#add8e6","lightcoral":"#f08080","lightcyan":"#e0ffff","lightgoldenrodyellow":"#fafad2","lightgray":"#d3d3d3","lightgreen":"#90ee90","lightpink":"#ffb6c1","lightsalmon":"#ffa07a","lightseagreen":"#20b2aa","lightskyblue":"#87cefa","lightslategray":"#778899","lightsteelblue":"#b0c4de","lightyellow":"#ffffe0","lime":"#00ff00","limegreen":"#32cd32","linen":"#faf0e6","magenta":"#ff00ff","maroon":"#800000","mediumaquamarine":"#66cdaa","mediumblue":"#0000cd","mediumorchid":"#ba55d3","mediumpurple":"#9370db","mediumseagreen":"#3cb371","mediumslateblue":"#7b68ee","mediumspringgreen":"#00fa9a","mediumturquoise":"#48d1cc","mediumvioletred":"#c71585","midnightblue":"#191970","mintcream":"#f5fffa","mistyrose":"#ffe4e1","moccasin":"#ffe4b5","navajowhite":"#ffdead","navy":"#000080","oldlace":"#fdf5e6","olive":"#808000","olivedrab":"#6b8e23","orange":"#ffa500","orangered":"#ff4500","orchid":"#da70d6","palegoldenrod":"#eee8aa","palegreen":"#98fb98","paleturquoise":"#afeeee","palevioletred":"#db7093","papayawhip":"#ffefd5","peachpuff":"#ffdab9","peru":"#cd853f","pink":"#ffc0cb","plum":"#dda0dd","powderblue":"#b0e0e6","purple":"#800080","rebeccapurple":"#663399","red":"#ff0000","rosybrown":"#bc8f8f","royalblue":"#4169e1","saddlebrown":"#8b4513","salmon":"#fa8072","sandybrown":"#f4a460","seagreen":"#2e8b57","seashell":"#fff5ee","sienna":"#a0522d","silver":"#c0c0c0","skyblue":"#87ceeb","slateblue":"#6a5acd","slategray":"#708090","snow":"#fffafa","springgreen":"#00ff7f","steelblue":"#4682b4","tan":"#d2b48c","teal":"#008080","thistle":"#d8bfd8","tomato":"#ff6347","turquoise":"#40e0d0","violet":"#ee82ee","wheat":"#f5deb3","white":"#ffffff","whitesmoke":"#f5f5f5","yellow":"#ffff00","yellowgreen":"#9acd32"};
    const REVERSE_CSS_COLORS = Object.fromEntries(Object.entries(CSS_COLORS).map(([k, v]) => [v, k]));

    // --- CORE LOGIC ---
    function updateColor(source, newColor) {
      if (newColor) {
        currentRgba = newColor;
      }
      
      const hex = rgbaToHex(currentRgba);
      const rgbaString = `rgba(${currentRgba.r}, ${currentRgba.g}, ${currentRgba.b}, ${currentRgba.a.toFixed(2)})`;
      const hsl = rgbaToHsl(currentRgba);
      const hslaString = `hsla(${hsl.h}, ${hsl.s}%, ${hsl.l}%, ${currentRgba.a.toFixed(2)})`;

      // Update UI elements
      preview.style.backgroundColor = rgbaString;

      if (source !== 'picker') {
        colorPicker.value = hex;
      }
      if (source !== 'text') {
        textInput.value = hex;
      }

      hexValue.textContent = hex;
      rgbaValue.textContent = `rgb(${currentRgba.r}, ${currentRgba.g}, ${currentRgba.b})`;
      hslValue.textContent = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
      hslaValue.textContent = hslaString;
      keywordValue.textContent = REVERSE_CSS_COLORS[hex.toLowerCase()] || 'N/A';
    }

    // --- INPUT HANDLERS ---
    colorPicker.addEventListener("input", () => {
      const rgba = hexToRgba(colorPicker.value);
      updateColor('picker', rgba);
    });

    textInput.addEventListener("input", () => {
      const parsedRgba = stringToRgba(textInput.value);
      if (parsedRgba) {
        updateColor('text', parsedRgba);
      }
    });

    // --- CONVERSION FUNCTIONS ---
    function rgbaToHex({ r, g, b }) {
      return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
    }

    function hexToRgba(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16),
        a: 1
      } : null;
    }
    
    function rgbaToHsl({ r, g, b, a }) {
        r /= 255; g /= 255; b /= 255;
        let max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max === min) {
            h = s = 0;
        } else {
            let d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
    }
    
    function stringToRgba(str) {
      str = str.trim().toLowerCase();
      
      // Keyword
      if (CSS_COLORS[str]) {
          return hexToRgba(CSS_COLORS[str]);
      }
      
      // HEX
      if (str.startsWith('#')) {
          return hexToRgba(str);
      }
      
      // RGB/RGBA
      let match = str.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*([0-9\.]+)?\)/);
      if (match) {
          return {
              r: parseInt(match[1]), g: parseInt(match[2]), b: parseInt(match[3]),
              a: match[4] !== undefined ? parseFloat(match[4]) : 1
          };
      }
      
      // HSL/HSLA
      match = str.match(/hsla?\((\d+)\s*,\s*(\d+)%?\s*,\s*(\d+)%?\s*,?\s*([0-9\.]+)?\)/);
      if (match) {
          return hslToRgba(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]), match[4] !== undefined ? parseFloat(match[4]) : 1);
      }
      
      return null;
    }

    function hslToRgba(h, s, l, a = 1) {
        s /= 100;
        l /= 100;
        let c = (1 - Math.abs(2 * l - 1)) * s,
            x = c * (1 - Math.abs((h / 60) % 2 - 1)),
            m = l - c/2,
            r = 0, g = 0, b = 0;

        if (0 <= h && h < 60) { [r,g,b] = [c,x,0]; } 
        else if (60 <= h && h < 120) { [r,g,b] = [x,c,0]; } 
        else if (120 <= h && h < 180) { [r,g,b] = [0,c,x]; } 
        else if (180 <= h && h < 240) { [r,g,b] = [0,x,c]; } 
        else if (240 <= h && h < 300) { [r,g,b] = [x,0,c]; } 
        else if (300 <= h && h < 360) { [r,g,b] = [c,0,x]; }
        
        r = Math.round((r + m) * 255);
        g = Math.round((g + m) * 255);
        b = Math.round((b + m) * 255);

        return { r, g, b, a };
    }
    
    // --- UTILITY ---
    function copy(id) {
      const text = document.getElementById(id).textContent;
      if (text && text !== 'N/A') {
        navigator.clipboard.writeText(text).then(() => alert("Copied: " + text));
      }
    }

    // --- FAVOURITES LOGIC ---
    function renderFavourites() {
      favouritesContainer.innerHTML = "";
      favourites.forEach((colorHex, index) => {
        const swatch = document.createElement("div");
        swatch.className = "fav-swatch";
        swatch.style.backgroundColor = colorHex;
        swatch.dataset.index = index;
        swatch.title = colorHex;
        
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-fav";
        deleteBtn.innerHTML = "&times;";
        deleteBtn.title = "Delete favourite";
        
        swatch.appendChild(deleteBtn);
        favouritesContainer.appendChild(swatch);
      });
    }
    
    saveFavouriteBtn.addEventListener('click', () => {
        const hex = rgbaToHex(currentRgba);
        if (!favourites.includes(hex)) {
            favourites.push(hex);
            localStorage.setItem("favouriteColors", JSON.stringify(favourites));
            renderFavourites();
        }
    });

    favouritesContainer.addEventListener('click', e => {
        const target = e.target;
        if (target.classList.contains('fav-swatch')) {
            const hex = favourites[target.dataset.index];
            updateColor('favourite', hexToRgba(hex));
        }
        if (target.classList.contains('delete-fav')) {
            e.stopPropagation();
            const index = target.parentElement.dataset.index;
            favourites.splice(index, 1);
            localStorage.setItem("favouriteColors", JSON.stringify(favourites));
            renderFavourites();
        }
    });

    // --- IMAGE PICKER LOGIC ---
    imageLoader.addEventListener('change', e => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const MAX_WIDTH = 400;
                    const scale = MAX_WIDTH / img.width;
                    imageCanvas.width = MAX_WIDTH;
                    imageCanvas.height = img.height * scale;
                    imageCtx.drawImage(img, 0, 0, imageCanvas.width, imageCanvas.height);
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    imageCanvas.addEventListener('mousemove', e => {
        const rect = imageCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const pixel = imageCtx.getImageData(x, y, 1, 1).data;
        const rgba = { r: pixel[0], g: pixel[1], b: pixel[2], a: pixel[3] / 255 };
        updateColor('image', rgba);
    });

    // --- CAMERA PICKER LOGIC ---
    startCameraBtn.addEventListener('click', async () => {
        try {
            videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            cameraFeed.srcObject = videoStream;
            cameraFeed.style.display = 'block';
            startCameraBtn.style.display = 'none';
            stopCameraBtn.style.display = 'inline-block';

            cameraFeed.onloadedmetadata = () => {
              cameraCanvas.width = cameraFeed.videoWidth;
              cameraCanvas.height = cameraFeed.videoHeight;
            }
        } catch (err) {
            console.error("Camera access denied:", err);
            alert("Could not access the camera. Please ensure you've granted permission.");
        }
    });

    stopCameraBtn.addEventListener('click', () => {
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
        }
        cameraFeed.style.display = 'none';
        startCameraBtn.style.display = 'inline-block';
        stopCameraBtn.style.display = 'none';
    });
    
    cameraFeed.addEventListener('click', e => {
        cameraCtx.drawImage(cameraFeed, 0, 0, cameraCanvas.width, cameraCanvas.height);
        const rect = cameraFeed.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        // Scale click coordinates to video resolution
        const scaleX = cameraFeed.videoWidth / rect.width;
        const scaleY = cameraFeed.videoHeight / rect.height;
        const pixel = cameraCtx.getImageData(x * scaleX, y * scaleY, 1, 1).data;
        const rgba = { r: pixel[0], g: pixel[1], b: pixel[2], a: pixel[3] / 255 };
        updateColor('camera', rgba);
    });


    // --- INITIALIZATION ---
    function initialize() {
        updateColor('init', currentRgba);
        renderFavourites();
    }

    initialize();
  </script>
</body>
</html>